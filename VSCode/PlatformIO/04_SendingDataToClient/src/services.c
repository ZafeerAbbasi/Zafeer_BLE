/*
# ##############################################################################
# File: services.c                                                             #
# Project: src                                                                 #
# Created Date: Tuesday, October 24th 2023, 9:41:38 pm                         #
# Author: Zafeer Abbasi                                                        #
# ----------------------------------------------                               #
# Last Modified: Wednesday, October 25th 2023, 7:57:01 pm                      #
# Modified By: Zafeer Abbasi                                                   #
# ----------------------------------------------                               #
# Copyright (c) 2023 Zafeer.A                                                  #
# ----------------------------------------------                               #
# HISTORY:                                                                     #
 */

/*##############################################################################################################################################*/
/*INCLUDES______________________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/

#include "bluenrg1_gap.h"
#include "bluenrg1_gatt_aci.h"
#include "services.h"

/*##############################################################################################################################################*/
/*FUNCTION DECLARATIONS_________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/



/*##############################################################################################################################################*/
/*GLOBALS_______________________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/

/*128-bit UUID ( Randomly Generated )*/
const uint8_t SERVICE_UUID[ 16 ]    = {0x66,0x9a,0x0c,0x20,0x00,0x08,0x96,0x9e,0xe2,0x11,0x9e,0xb1,0xe0,0xf2,0x73,0xd9};
const uint8_t CHAR_UUID[ 16 ]       = {0x66,0x9a,0x0c,0x20,0x00,0x08,0x96,0x9e,0xe2,0x11,0x9e,0xb1,0xe1,0xf2,0x73,0xd9};


uint16_t customServiceHdl, customCharacteristicHdl;

/*##############################################################################################################################################*/
/*DEFINES_______________________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/



/*##############################################################################################################################################*/
/*EXTERNS_______________________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/



/*##############################################################################################################################################*/
/*TYPEDEFS/STRUCTS/ENUMS________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/



/*##############################################################################################################################################*/
/*FUNCTIONS_____________________________________________________________________________________________________________________________________*/
/*##############################################################################################################################################*/

tBleStatus service_AddService( void )
{
    tBleStatus ret;
    
    Service_UUID_t  serviceUUID;
    Char_UUID_t     characteristicUUID;
    char *name =  "Zafeer";
        
    memcpy( serviceUUID.Service_UUID_128, SERVICE_UUID , sizeof( SERVICE_UUID ) );
    memcpy( characteristicUUID.Char_UUID_128, CHAR_UUID, sizeof( CHAR_UUID ) );

    /*Add Service*/
    ret = aci_gatt_add_service(
        UUID_TYPE_128,
        &serviceUUID,
        PRIMARY_SERVICE,
        7,
        &customServiceHdl
    );

    /*Add Characteristic*/
    ret = aci_gatt_add_char( 
        customServiceHdl,
        UUID_TYPE_128,
        &characteristicUUID,
        2,
        CHAR_PROP_NOTIFY,
        ATTR_PERMISSION_NONE,
        GATT_DONT_NOTIFY_EVENTS,
        0,
        0,
        &customCharacteristicHdl
    );

    return ret;
}

void service_UpdateData( int16_t newData )
{
    tBleStatus ret;

    /*Update Characteristics Value*/
    ret = aci_gatt_update_char_value(
        customServiceHdl,
        customCharacteristicHdl,
        0,
        2,
        ( uint8_t * )&newData
    );

    
}